import { Component, Input, forwardRef, ViewChild, ViewEncapsulation, HostListener, Output, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { startOfMonth, endOfMonth, addMonths, subMonths, setYear, eachDayOfInterval, getDate, getMonth, getYear, isToday, isSameMonth, format, getDay, subDays, setDay, isAfter, isBefore, addDays, setMonth, } from 'date-fns';
import { isSameDate, createDateRange, isNull } from '../../helpers';
// instanceID for calculating the auto-incrementing field ID
let instanceID = 0;
export class NgxDatePickerComponent {
    constructor() {
        /**
         * Set date picker's visibility state
         */
        this.isOpened = true;
        this.valueChange = new EventEmitter();
        this.currentOptions = {
            closeOnClickOutside: false,
            closeOnSelection: true,
            includeDays: 'all',
            includeNextMonthsFirstFullWeek: false,
            minYear: 1900,
            maxYear: 2050,
            displayFormat: 'MMM d, yyyy',
            barTitleFormat: 'MMM yyyy',
            dayNamesFormat: 'EEEEEE',
            rangeSeparator: '-',
            selectRange: false,
            firstCalendarDay: 0,
            barTitleIfEmpty: 'Click to select a date',
            locale: {},
            fieldId: this.defaultFieldId,
            useEmptyBarTitle: true,
            mobileStyle: 'dialog'
        };
        this.onTouchedCallback = () => { };
        this.onChangeCallback = (_) => {
            this.valueChange.emit(_);
        };
        this.formatDay = (date, isVisible = true) => ({
            date,
            day: getDate(date),
            month: getMonth(date),
            year: getYear(date),
            inThisMonth: isSameMonth(date, this.viewingDate),
            isToday: isVisible && isToday(date),
            isSelected: isVisible && this.isDateSelected(date),
            isInRange: isVisible && this.isInRange(date),
            isSelectable: isVisible && this.isDateSelectable(date),
            isStart: isVisible && this.isRangeBoundary(date, 'start'),
            isEnd: isVisible && this.isRangeBoundary(date, 'end'),
            isVisible,
        });
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    set range(val) {
        this._range = val;
    }
    get range() {
        return this._range;
    }
    get wrapperStyle() {
        switch (this.currentOptions.mobileStyle) {
            case 'dialog':
                return this.isInline === false ? 'form-date' : 'inline-date';
            case 'normal':
            default:
                return '';
        }
    }
    ngOnInit() {
        if (typeof startOfMonth === 'undefined') {
            throw new Error('module date-fns is required by <ngx-date-picker> to function.');
        }
        this.view = 'days';
        this.range = this.range || {
            start: new Date(),
            end: new Date(),
        };
        if (this.value && !(this.value instanceof Date)) {
            this.range = this.value;
            this.viewingDate = this.range.start;
        }
        else if (this.value && this.value instanceof Date) {
            this.viewingDate = this.value;
        }
        else {
            this.viewingDate = this.range.start;
        }
        this.updateOptions(this.options);
        this.initDayNames();
        this.initYears();
        this.initMonths();
        this.init();
    }
    ngOnChanges(changes) {
        if ('options' in changes) {
            this.updateOptions(changes.options.currentValue);
            this.initDayNames();
            this.init();
            this.initYears();
            this.initMonths();
        }
    }
    get defaultFieldId() {
        // Only evaluate and increment if required
        const value = `ngx-date-picker-${instanceID++}`;
        Object.defineProperty(this, 'defaultFieldId', { value });
        return value;
    }
    updateOptions(options) {
        this.currentOptions = Object.assign(Object.assign({}, this.currentOptions), options);
    }
    writeValue(val) {
        if (val) {
            if (typeof val === 'string') {
                this.range.start = this.range.end = new Date(val);
            }
            else if (val instanceof Date) {
                this.range.start = this.range.end = val;
            }
            else if (val.start) { // Checking if it's instance of DateRange
                this.range = val;
            }
            else {
                throw Error('Invalid input data type');
            }
            this.viewingDate = this.range.start || this.viewingDate || new Date();
            this.init();
        }
    }
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    getDayClasses(day) {
        return {
            'is-prev-month': !day.inThisMonth,
            'is-today': day.isToday,
            'is-selected': day.isSelected,
            'is-in-range': day.isInRange,
            'is-disabled': !day.isSelectable,
            'range-start': day.isStart,
            'range-end': day.isEnd,
            'is-visible': day.isVisible,
        };
    }
    /**
     * Checks if specified date is in range of min and max dates
     */
    isDateSelectable(date) {
        const minDateSet = !isNull(this.currentOptions.minDate);
        const maxDateSet = !isNull(this.currentOptions.maxDate);
        const timestamp = date.valueOf();
        // Check if the date range is set and between min and max
        const _isAboveMinDate = minDateSet ? timestamp >= this.currentOptions.minDate.valueOf() : true;
        const _isBelowMaxDate = maxDateSet ? timestamp <= this.currentOptions.maxDate.valueOf() : true;
        return _isAboveMinDate && _isBelowMaxDate;
    }
    isDateSelected(date) {
        return this.range && this.range.start ? isSameDate(date, this.range.start) || isSameDate(date, this.range.end) : false;
    }
    isInRange(date) {
        return this.isDateSelected(date) || this.range && this.range.start ? (isAfter(date, this.range.start) && isBefore(date, this.range.end)) : false;
    }
    formatDisplay() {
        if (!this.range) {
            return '';
        }
        const formattedStartDate = format(this.range.start, this.currentOptions.displayFormat, this.currentOptions.locale);
        if (this.currentOptions.selectRange) {
            const formattedEndDate = format(this.range.end || this.range.start, this.currentOptions.displayFormat, this.currentOptions.locale);
            return `${formattedStartDate} ${this.currentOptions.rangeSeparator} ${formattedEndDate}`;
        }
        return formattedStartDate;
    }
    isRangeBoundary(date, boundary) {
        return this.range ? !this.range[boundary] || isSameDate(date, this.range[boundary]) : false;
    }
    getValueToEmit(range) {
        if (!range || !range.start) {
            return null;
        }
        if (!this.currentOptions.selectRange) {
            return new Date(range.start.getTime());
        }
        if (range.end) {
            return createDateRange(range.start, range.end);
        }
        return createDateRange(range.start, range.start);
    }
    // ############### Day #################
    init() {
        if (!this.viewingDate) {
            return;
        }
        const start = startOfMonth(this.viewingDate);
        const end = endOfMonth(this.viewingDate);
        this.days = eachDayOfInterval({ start, end }).map((date) => this.formatDay(date));
        const firstMonthDay = getDay(start) - this.currentOptions.firstCalendarDay;
        const prevDays = firstMonthDay < 0 ? 7 - this.currentOptions.firstCalendarDay : firstMonthDay;
        let nextDays = (this.currentOptions.firstCalendarDay === 1 ? 7 : 6) - getDay(end);
        const showPrevMonthDays = this.currentOptions.includeDays === 'all' || this.currentOptions.includeDays === 'previous-month';
        const showNextMonthDays = this.currentOptions.includeDays === 'all' || this.currentOptions.includeDays === 'next-month';
        if (showNextMonthDays && this.currentOptions.includeNextMonthsFirstFullWeek) {
            nextDays += 7;
        }
        for (let i = 1; i <= prevDays; i++) {
            this.days.unshift(this.formatDay(subDays(start, i), showPrevMonthDays));
        }
        new Array(nextDays).fill(undefined)
            .forEach((_, i) => this.days.push(this.formatDay(addDays(end, i + 1), showNextMonthDays)));
        this.displayValue = this.formatDisplay();
        if (this.range) {
            this.barTitle = format(this.viewingDate, this.currentOptions.barTitleFormat, this.currentOptions.locale);
        }
        else {
            this.barTitle = this.currentOptions.useEmptyBarTitle ?
                this.currentOptions.barTitleIfEmpty :
                format(this.viewingDate, this.currentOptions.barTitleFormat, this.currentOptions.locale);
        }
    }
    setDate(i) {
        const date = this.days[i].date;
        const _range = this.range || {};
        if (this.currentOptions.selectRange) {
            if (!this.range || (!this.range.start && !this.range.end)) {
                _range.start = date;
            }
            else if (this.range.start && !this.range.end && isAfter(date, this.range.start)) {
                _range.end = date;
            }
            else {
                _range.end = undefined;
                _range.start = date;
            }
        }
        else {
            _range.start = _range.end = date;
        }
        this.range = _range;
        this.init();
        this.onChangeCallback(this.getValueToEmit(this.range));
        // Close if last value is selected
        if (this.currentOptions.closeOnSelection && this.range.end) {
            this.close();
        }
    }
    initDayNames() {
        this.dayNames = [];
        const start = this.currentOptions.firstCalendarDay;
        for (let i = start; i <= 6 + start; i++) {
            const date = setDay(new Date(), i);
            this.dayNames.push(format(date, this.currentOptions.dayNamesFormat, this.currentOptions.locale));
        }
    }
    // ############### Month ###############
    setMonth(i) {
        this.viewingDate = setMonth(this.viewingDate, this.months[i].month);
        this.init();
        this.initMonths();
        this.view = 'days';
    }
    initMonths() {
        this.months = Array.from(new Array(12), (x, i) => setMonth(new Date(), i))
            .map((date) => {
            return { month: date.getMonth(), name: format(date, 'MMM'), isSelected: date.getMonth() === getMonth(this.viewingDate) };
        });
    }
    nextMonth() {
        this.viewingDate = addMonths(this.viewingDate, 1);
        this.init();
    }
    prevMonth() {
        this.viewingDate = subMonths(this.viewingDate, 1);
        this.init();
    }
    // ############### Year ################
    initYears() {
        const range = this.currentOptions.maxYear - this.currentOptions.minYear;
        /* tslint:disable */
        // Ignore the rule due to the uniqeness of the arrow chain.
        this.years = Array.from(new Array(range), (x, i) => { return { index: i, year: i + this.currentOptions.minYear }; }).map(({ index, year }) => {
            return { index: index, year: year, isThisYear: year === getYear(this.viewingDate) };
        });
        /* tslint:enable */
    }
    scrollYears() {
        setTimeout(() => {
            const _heightOfYearElement = 40;
            const _yearIndex = this.years.filter(item => item.isThisYear)[0];
            const _scrollPosition = ((_yearIndex.index / 3) * _heightOfYearElement) - 30;
            this.calendarYearsContainer.nativeElement.scroll(0, _scrollPosition);
        }, 100);
    }
    setYear(i) {
        this.viewingDate = setYear(this.viewingDate, this.years[i].year);
        this.init();
        this.initYears();
        this.view = 'months';
    }
    // ############### Container ################
    toggleView() {
        this.view = this.view === 'days' ? 'years' : 'days';
        this.scrollYears();
    }
    toggle() {
        this.isOpened = !this.isOpened;
        if (!this.isOpened && this.view === 'years') {
            this.toggleView();
        }
        if (this.isOpened && this.view === 'days') {
            this.viewingDate = this.range && this.range.start ? this.range.start : this.viewingDate || new Date();
            this.init();
        }
    }
    reset() {
        this.range = {
            start: new Date(),
            end: new Date(),
        };
        this.init();
    }
    // ############### Misc ################
    onBlur(e) {
        if (!this.isOpened || !this.currentOptions.closeOnClickOutside) {
            return;
        }
        if ((e.target.parentElement && e.target.parentElement.classList.contains('day-unit'))) {
            return;
        }
        if (this.calendarContainerElement.nativeElement !== e.target &&
            !this.calendarContainerElement.nativeElement.contains(e.target) &&
            !e.target.classList.contains('year-unit') &&
            !e.target.classList.contains('month-unit')) {
            this.close();
        }
    }
    close() {
        this.isOpened = false;
        if (this.view === 'years') {
            this.toggleView();
        }
    }
}
NgxDatePickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-date-picker',
                template: "<div *ngIf=\"isOpened\" class=\"ngx-date-picker-calendar-wrapper {{wrapperStyle}}\">\r\n\r\n  <div #container class=\"ngx-date-picker-calendar-container\">\r\n\r\n    <!-- Top Bar -->\r\n    <div class=\"ngx-date-picker-navbar\">\r\n\r\n      <div class=\"ngx-date-picker-navbar-item\" (click)=\"prevMonth()\">\r\n        <i class=\"arrow left\"></i>\r\n      </div>\r\n\r\n      <span class=\"ngx-date-picker-title\" (click)=\"toggleView()\">{{ barTitle }}</span>\r\n\r\n      <div class=\"ngx-date-picker-navbar-item\" (click)=\"nextMonth()\">\r\n        <i class=\"arrow right\"></i>\r\n      </div>\r\n\r\n    </div>\r\n\r\n    <div class=\"main-calendar-container\">\r\n\r\n      <!-- Days -->\r\n      <div [ngClass]=\"{ 'show': view === 'days', 'hidden': view !== 'days' }\">\r\n        <div class=\"main-calendar-day-names\">\r\n          <span class=\"day-name-unit\" *ngFor=\"let name of dayNames\">{{ name }}</span>\r\n        </div>\r\n        <div class=\"main-calendar-days\">\r\n          <span class=\"day-unit\" *ngFor=\"let day of days; let i = index;\" (click)=\"day.isSelectable && setDate(i)\">\r\n            <span class=\"day-background-upper\"\r\n              [ngClass]=\"this.getDayClasses(day)\">{{ day.isVisible ? day.day : '' }}</span>\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Months -->\r\n      <div [ngClass]=\"{ 'show': view === 'months', 'hidden': view !== 'months' }\">\r\n        <div class=\"main-calendar-months\">\r\n          <span *ngFor=\"let month of months; let i = index;\" class=\"month-unit\"\r\n            [ngClass]=\"{ 'is-selected': month.isSelected}\" (click)=\"setMonth(i)\">\r\n            {{ month.name }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Years -->\r\n      <div [ngClass]=\"{ 'show': view === 'years', 'hidden': view !== 'years' }\">\r\n        <div #calendarYearsContainer class=\"main-calendar-years\">\r\n          <span *ngFor=\"let year of years; let i = index;\" class=\"year-unit\"\r\n            [ngClass]=\"{ 'is-selected': year.isThisYear }\" (click)=\"setYear(i)\">\r\n            {{ year.year }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n\r\n  </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None,
                providers: [
                    { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => NgxDatePickerComponent), multi: true }
                ],
                styles: [".ngx-date-picker-calendar-container{background:#fff;border:1px solid #dfe3e9;border-radius:4px;box-shadow:0 10px 14px 10px rgba(0,0,0,.08);max-width:100vw;position:absolute;width:300px;z-index:100}@media (max-width:768px){.ngx-date-picker-calendar-wrapper.form-date{background:hsla(0,0%,78.4%,.5);height:100vh;left:0;position:fixed;top:0;width:100vw;z-index:9999}.ngx-date-picker-calendar-wrapper.form-date .ngx-date-picker-calendar-container{left:50%;max-width:100vw;top:50%;transform:translate(-50%,-50%);width:90vw}.ngx-date-picker-calendar-wrapper.form-date .ngx-date-picker-title{font-size:1rem}.ngx-date-picker-calendar-wrapper.form-date .day-unit,.ngx-date-picker-calendar-wrapper.form-date .month-unit,.ngx-date-picker-calendar-wrapper.form-date .year-unit{font-size:1rem;height:2rem}}.ngx-date-picker-navbar{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;align-items:center;border-bottom:1px solid #dfe3e9;display:flex;height:50px;justify-content:space-between;user-select:none}.ngx-date-picker-navbar .ngx-date-picker-navbar-item{cursor:pointer;padding:16px}.ngx-date-picker-navbar .ngx-date-picker-navbar-item .arrow{border:solid #000;border-width:0 3px 3px 0;display:inline-block;padding:3px}.ngx-date-picker-navbar .ngx-date-picker-navbar-item .arrow.right{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.ngx-date-picker-navbar .ngx-date-picker-navbar-item .arrow.left{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.ngx-date-picker-title{color:#3d495c;cursor:pointer;font-size:14px;font-weight:600}.main-calendar-container{box-sizing:border-box;font-size:12px;font-weight:500;height:100%;padding:15px 10px;width:100%}.main-calendar-container .show{display:block}.main-calendar-container .hidden{display:none}.main-calendar-day-names{align-items:center;box-sizing:border-box;color:#cbcbcb;display:flex;width:100%}.day-name-unit{margin:5px 5px 0 0;text-align:center;text-transform:uppercase;width:14.28571%}.main-calendar-days{overflow:hidden}.main-calendar-days,.main-calendar-years{display:inline-block;padding:15px 0 0;width:100%}.main-calendar-years{overflow-x:hidden;overflow-y:scroll}.main-calendar-years::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#f5f5f5}.main-calendar-years::-webkit-scrollbar{background-color:#f5f5f5;width:6px}.main-calendar-years::-webkit-scrollbar-thumb{background-color:#000}.day-unit,.month-unit,.year-unit{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;cursor:pointer;float:left;font-size:14px;font-weight:400;height:35px;margin:5px 5px 0 0;position:relative;user-select:none;width:calc(14.28571% - 5px)}.day-background-upper,.day-unit,.month-unit,.year-unit{align-items:center;display:inline-flex;justify-content:center}.day-background-upper{background:#f0f0f0;border-radius:4px;color:#333;height:100%;position:absolute;width:100%;z-index:1}.day-background-upper:not(.is-visible){cursor:default}.day-background-upper:hover{background:rgba(255,0,0,.6);color:#f0f0f0}.day-background-upper.is-prev-month{color:#cbcbcb}.day-background-upper.is-prev-month:hover{background:rgba(255,0,0,.6);color:#f0f0f0}.day-background-upper.is-disabled{color:#cbcbcb;cursor:not-allowed}.day-background-upper.is-in-range{background:rgba(255,0,0,.6);color:#f0f0f0}.day-background-upper.is-selected{background:red;color:#f0f0f0}.main-calendar-years{display:block;height:210px;padding:0}.month-unit{height:54px;width:calc(25% - 5px)}.year-unit{width:calc(33.33333% - 5px)}.month-unit,.year-unit{border-radius:4px}.month-unit.is-selected,.year-unit.is-selected{background:red;color:#f0f0f0}.month-unit:hover,.year-unit:hover{background:rgba(255,0,0,.6);color:#f0f0f0}.main-calendar-months{display:inline-block;padding-bottom:10px}"]
            },] }
];
NgxDatePickerComponent.propDecorators = {
    calendarContainerElement: [{ type: ViewChild, args: ['container',] }],
    calendarYearsContainer: [{ type: ViewChild, args: ['calendarYearsContainer',] }],
    value: [{ type: Input }],
    options: [{ type: Input }],
    isOpened: [{ type: Input }],
    valueChange: [{ type: Output }],
    onBlur: [{ type: HostListener, args: ['document:click', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWRhdGUtcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1kYXRlLXBpY2tlci9zcmMvY29tcG9uZW50L2RhdGUtcGlja2VyL25neC1kYXRlLXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFFVCxLQUFLLEVBSUwsVUFBVSxFQUNWLFNBQVMsRUFDVCxpQkFBaUIsRUFDakIsWUFBWSxFQUNaLE1BQU0sRUFDTixZQUFZLEVBQ2YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBR3pFLE9BQU8sRUFDSCxZQUFZLEVBQ1osVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBQ1QsT0FBTyxFQUNQLGlCQUFpQixFQUNqQixPQUFPLEVBQ1AsUUFBUSxFQUNSLE9BQU8sRUFDUCxPQUFPLEVBQ1AsV0FBVyxFQUNYLE1BQU0sRUFDTixNQUFNLEVBQ04sT0FBTyxFQUNQLE1BQU0sRUFDTixPQUFPLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEdBQ3ZDLE1BQU0sVUFBVSxDQUFDO0FBRWxCLE9BQU8sRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUtwRSw0REFBNEQ7QUFDNUQsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBV25CLE1BQU0sT0FBTyxzQkFBc0I7SUFUbkM7UUFrQkk7O1dBRUc7UUFDTSxhQUFRLEdBQUcsSUFBSSxDQUFDO1FBRWYsZ0JBQVcsR0FBbUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUzRSxtQkFBYyxHQUFzQjtZQUNoQyxtQkFBbUIsRUFBRSxLQUFLO1lBQzFCLGdCQUFnQixFQUFFLElBQUk7WUFDdEIsV0FBVyxFQUFFLEtBQUs7WUFDbEIsOEJBQThCLEVBQUUsS0FBSztZ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QUM7Z0JBQ1AsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0Isc3NFQUE2QztnQkFFN0MsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7Z0JBQ3JDLFNBQVMsRUFBRTtvQkFDUCxFQUFFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHNCQUFzQixDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtpQkFDckc7O2FBQ0o7Ozt1Q0FHSSxTQUFTLFNBQUMsV0FBVztxQ0FDckIsU0FBUyxTQUFDLHdCQUF3QjtvQkFHbEMsS0FBSztzQkFDTCxLQUFLO3VCQUtMLEtBQUs7MEJBRUwsTUFBTTtxQkFxWk4sWUFBWSxTQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCxcclxuICAgIE9uSW5pdCxcclxuICAgIElucHV0LFxyXG4gICAgT25DaGFuZ2VzLFxyXG4gICAgU2ltcGxlQ2hhbmdlcyxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBmb3J3YXJkUmVmLFxyXG4gICAgVmlld0NoaWxkLFxyXG4gICAgVmlld0VuY2Fwc3VsYXRpb24sXHJcbiAgICBIb3N0TGlzdGVuZXIsXHJcbiAgICBPdXRwdXQsXHJcbiAgICBFdmVudEVtaXR0ZXJcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5cclxuXHJcbmltcG9ydCB7XHJcbiAgICBzdGFydE9mTW9udGgsXHJcbiAgICBlbmRPZk1vbnRoLFxyXG4gICAgYWRkTW9udGhzLFxyXG4gICAgc3ViTW9udGhzLFxyXG4gICAgc2V0WWVhcixcclxuICAgIGVhY2hEYXlPZkludGVydmFsLFxyXG4gICAgZ2V0RGF0ZSxcclxuICAgIGdldE1vbnRoLFxyXG4gICAgZ2V0WWVhcixcclxuICAgIGlzVG9kYXksXHJcbiAgICBpc1NhbWVNb250aCxcclxuICAgIGZvcm1hdCxcclxuICAgIGdldERheSxcclxuICAgIHN1YkRheXMsXHJcbiAgICBzZXREYXksXHJcbiAgICBpc0FmdGVyLCBpc0JlZm9yZSwgYWRkRGF5cywgc2V0TW9udGgsXHJcbn0gZnJvbSAnZGF0ZS1mbnMnO1xyXG5cclxuaW1wb3J0IHsgaXNTYW1lRGF0ZSwgY3JlYXRlRGF0ZVJhbmdlLCBpc051bGwgfSBmcm9tICcuLi8uLi9oZWxwZXJzJztcclxuaW1wb3J0IHsgRGF0ZVJhbmdlLCBEYXkgfSBmcm9tICcuLi8uLi9tb2RlbHMnO1xyXG5pbXBvcnQgeyBEYXRlUGlja2VyT3B0aW9ucywgQWRkQ2xhc3MgfSBmcm9tICcuLi8uLi9uZ3gtZGF0ZS1waWNrZXIub3B0aW9ucyc7XHJcblxyXG5cclxuLy8gaW5zdGFuY2VJRCBmb3IgY2FsY3VsYXRpbmcgdGhlIGF1dG8taW5jcmVtZW50aW5nIGZpZWxkIElEXHJcbmxldCBpbnN0YW5jZUlEID0gMDtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICduZ3gtZGF0ZS1waWNrZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICduZ3gtZGF0ZS1waWNrZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJ25neC1kYXRlLXBpY2tlci5jb21wb25lbnQuc2NzcyddLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIHsgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5neERhdGVQaWNrZXJDb21wb25lbnQpLCBtdWx0aTogdHJ1ZSB9XHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ3hEYXRlUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdjb250YWluZXInKSBjYWxlbmRhckNvbnRhaW5lckVsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdjYWxlbmRhclllYXJzQ29udGFpbmVyJykgY2FsZW5kYXJZZWFyc0NvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuXHJcblxyXG4gICAgQElucHV0KCkgdmFsdWU6IERhdGUgfCBEYXRlUmFuZ2U7XHJcbiAgICBASW5wdXQoKSBvcHRpb25zOiBEYXRlUGlja2VyT3B0aW9ucztcclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCBkYXRlIHBpY2tlcidzIHZpc2liaWxpdHkgc3RhdGVcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaXNPcGVuZWQgPSB0cnVlO1xyXG5cclxuICAgIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZTogRXZlbnRFbWl0dGVyPERhdGUgfCBEYXRlUmFuZ2U+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIGN1cnJlbnRPcHRpb25zOiBEYXRlUGlja2VyT3B0aW9ucyA9IHtcclxuICAgICAgICBjbG9zZU9uQ2xpY2tPdXRzaWRlOiBmYWxzZSxcclxuICAgICAgICBjbG9zZU9uU2VsZWN0aW9uOiB0cnVlLFxyXG4gICAgICAgIGluY2x1ZGVEYXlzOiAnYWxsJyxcclxuICAgICAgICBpbmNsdWRlTmV4dE1vbnRoc0ZpcnN0RnVsbFdlZWs6IGZhbHNlLFxyXG4gICAgICAgIG1pblllYXI6IDE5MDAsXHJcbiAgICAgICAgbWF4WWVhcjogMjA1MCxcclxuICAgICAgICBkaXNwbGF5Rm9ybWF0OiAnTU1NIGQsIHl5eXknLFxyXG4gICAgICAgIGJhclRpdGxlRm9ybWF0OiAnTU1NIHl5eXknLFxyXG4gICAgICAgIGRheU5hbWVzRm9ybWF0OiAnRUVFRUVFJyxcclxuICAgICAgICByYW5nZVNlcGFyYXRvcjogJy0nLFxyXG4gICAgICAgIHNlbGVjdFJhbmdlOiBmYWxzZSxcclxuICAgICAgICBmaXJzdENhbGVuZGFyRGF5OiAwLFxyXG4gICAgICAgIGJhclRpdGxlSWZFbXB0eTogJ0NsaWNrIHRvIHNlbGVjdCBhIGRhdGUnLFxyXG4gICAgICAgIGxvY2FsZToge30sXHJcbiAgICAgICAgZmllbGRJZDogdGhpcy5kZWZhdWx0RmllbGRJZCxcclxuICAgICAgICB1c2VFbXB0eUJhclRpdGxlOiB0cnVlLFxyXG4gICAgICAgIG1vYmlsZVN0eWxlOiAnZGlhbG9nJ1xyXG4gICAgfTtcclxuXHJcbiAgICBpc0lubGluZTogYm9vbGVhbjtcclxuICAgIGRpc3BsYXlWYWx1ZTogc3RyaW5nO1xyXG4gICAgdmlld2luZ0RhdGU6IERhdGU7XHJcbiAgICBiYXJUaXRsZTogc3RyaW5nO1xyXG4gICAgdmlldzogJ2RheXMnIHwgJ21vbnRocycgfCAneWVhcnMnO1xyXG4gICAgeWVhcnM6IHsgaW5kZXg6IG51bWJlciwgeWVhcjogbnVtYmVyOyBpc1RoaXNZZWFyOiBib29sZWFuIH1bXTtcclxuICAgIG1vbnRoczogeyBtb250aDogbnVtYmVyOyBuYW1lOiBzdHJpbmc7IGlzU2VsZWN0ZWQ6IGJvb2xlYW4gfVtdO1xyXG4gICAgZGF5TmFtZXM6IHN0cmluZ1tdO1xyXG4gICAgZGF5czogRGF5W107XHJcbiAgICBmaWVsZElkOiBzdHJpbmc7XHJcbiAgICBkaXNhYmxlZDogYm9vbGVhbjtcclxuXHJcbiAgICBwcml2YXRlIF9yYW5nZTogRGF0ZVJhbmdlO1xyXG5cclxuICAgIHByaXZhdGUgb25Ub3VjaGVkQ2FsbGJhY2s6ICgpID0+IHZvaWQgPSAoKSA9PiB7IH07XHJcbiAgICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6IChfOiBEYXRlIHwgRGF0ZVJhbmdlKSA9PiB2b2lkID0gKF8pID0+IHtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoXyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCByYW5nZSh2YWw6IERhdGVSYW5nZSB8IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRoaXMuX3JhbmdlID0gdmFsO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCByYW5nZSgpOiBEYXRlUmFuZ2UgfCB1bmRlZmluZWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yYW5nZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgd3JhcHBlclN0eWxlKCkge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5jdXJyZW50T3B0aW9ucy5tb2JpbGVTdHlsZSkge1xyXG4gICAgICAgICAgICBjYXNlICdkaWFsb2cnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNJbmxpbmUgPT09IGZhbHNlID8gJ2Zvcm0tZGF0ZScgOiAnaW5saW5lLWRhdGUnO1xyXG4gICAgICAgICAgICBjYXNlICdub3JtYWwnOlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBzdGFydE9mTW9udGggPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbW9kdWxlIGRhdGUtZm5zIGlzIHJlcXVpcmVkIGJ5IDxuZ3gtZGF0ZS1waWNrZXI+IHRvIGZ1bmN0aW9uLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy52aWV3ID0gJ2RheXMnO1xyXG4gICAgICAgIHRoaXMucmFuZ2UgPSB0aGlzLnJhbmdlIHx8IHtcclxuICAgICAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgIGVuZDogbmV3IERhdGUoKSxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy52YWx1ZSAmJiAhKHRoaXMudmFsdWUgaW5zdGFuY2VvZiBEYXRlKSkge1xyXG4gICAgICAgICAgICB0aGlzLnJhbmdlID0gdGhpcy52YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy52aWV3aW5nRGF0ZSA9IHRoaXMucmFuZ2Uuc3RhcnQ7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZhbHVlICYmIHRoaXMudmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld2luZ0RhdGUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld2luZ0RhdGUgPSB0aGlzLnJhbmdlLnN0YXJ0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHRoaXMub3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5pbml0RGF5TmFtZXMoKTtcclxuICAgICAgICB0aGlzLmluaXRZZWFycygpO1xyXG4gICAgICAgIHRoaXMuaW5pdE1vbnRocygpO1xyXG5cclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKCdvcHRpb25zJyBpbiBjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyhjaGFuZ2VzLm9wdGlvbnMuY3VycmVudFZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5pbml0RGF5TmFtZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFllYXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdE1vbnRocygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVmYXVsdEZpZWxkSWQoKTogc3RyaW5nIHtcclxuICAgICAgICAvLyBPbmx5IGV2YWx1YXRlIGFuZCBpbmNyZW1lbnQgaWYgcmVxdWlyZWRcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGBuZ3gtZGF0ZS1waWNrZXItJHtpbnN0YW5jZUlEKyt9YDtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2RlZmF1bHRGaWVsZElkJywgeyB2YWx1ZSB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZU9wdGlvbnMob3B0aW9uczogRGF0ZVBpY2tlck9wdGlvbnMpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAuLi50aGlzLmN1cnJlbnRPcHRpb25zLFxyXG4gICAgICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVWYWx1ZSh2YWw6IERhdGVSYW5nZSB8IERhdGUgfCBzdHJpbmcgfCB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yYW5nZS5zdGFydCA9IHRoaXMucmFuZ2UuZW5kID0gbmV3IERhdGUodmFsKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJhbmdlLnN0YXJ0ID0gdGhpcy5yYW5nZS5lbmQgPSB2YWw7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsLnN0YXJ0KSB7IC8vIENoZWNraW5nIGlmIGl0J3MgaW5zdGFuY2Ugb2YgRGF0ZVJhbmdlXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJhbmdlID0gdmFsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ0ludmFsaWQgaW5wdXQgZGF0YSB0eXBlJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudmlld2luZ0RhdGUgPSB0aGlzLnJhbmdlLnN0YXJ0IHx8IHRoaXMudmlld2luZ0RhdGUgfHwgbmV3IERhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpIHtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSBmbjtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KSB7XHJcbiAgICAgICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIGZvcm1hdERheSA9IChkYXRlOiBEYXRlLCBpc1Zpc2libGU6IGJvb2xlYW4gPSB0cnVlKTogRGF5ID0+IChcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRhdGUsXHJcbiAgICAgICAgICAgIGRheTogZ2V0RGF0ZShkYXRlKSxcclxuICAgICAgICAgICAgbW9udGg6IGdldE1vbnRoKGRhdGUpLFxyXG4gICAgICAgICAgICB5ZWFyOiBnZXRZZWFyKGRhdGUpLFxyXG4gICAgICAgICAgICBpblRoaXNNb250aDogaXNTYW1lTW9udGgoZGF0ZSwgdGhpcy52aWV3aW5nRGF0ZSksXHJcbiAgICAgICAgICAgIGlzVG9kYXk6IGlzVmlzaWJsZSAmJiBpc1RvZGF5KGRhdGUpLFxyXG4gICAgICAgICAgICBpc1NlbGVjdGVkOiBpc1Zpc2libGUgJiYgdGhpcy5pc0RhdGVTZWxlY3RlZChkYXRlKSxcclxuICAgICAgICAgICAgaXNJblJhbmdlOiBpc1Zpc2libGUgJiYgdGhpcy5pc0luUmFuZ2UoZGF0ZSksXHJcbiAgICAgICAgICAgIGlzU2VsZWN0YWJsZTogaXNWaXNpYmxlICYmIHRoaXMuaXNEYXRlU2VsZWN0YWJsZShkYXRlKSxcclxuICAgICAgICAgICAgaXNTdGFydDogaXNWaXNpYmxlICYmIHRoaXMuaXNSYW5nZUJvdW5kYXJ5KGRhdGUsICdzdGFydCcpLFxyXG4gICAgICAgICAgICBpc0VuZDogaXNWaXNpYmxlICYmIHRoaXMuaXNSYW5nZUJvdW5kYXJ5KGRhdGUsICdlbmQnKSxcclxuICAgICAgICAgICAgaXNWaXNpYmxlLFxyXG4gICAgICAgIH1cclxuICAgIClcclxuXHJcbiAgICBnZXREYXlDbGFzc2VzKGRheTogRGF5KTogQWRkQ2xhc3Mge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICdpcy1wcmV2LW1vbnRoJzogIWRheS5pblRoaXNNb250aCxcclxuICAgICAgICAgICAgJ2lzLXRvZGF5JzogZGF5LmlzVG9kYXksXHJcbiAgICAgICAgICAgICdpcy1zZWxlY3RlZCc6IGRheS5pc1NlbGVjdGVkLFxyXG4gICAgICAgICAgICAnaXMtaW4tcmFuZ2UnOiBkYXkuaXNJblJhbmdlLFxyXG4gICAgICAgICAgICAnaXMtZGlzYWJsZWQnOiAhZGF5LmlzU2VsZWN0YWJsZSxcclxuICAgICAgICAgICAgJ3JhbmdlLXN0YXJ0JzogZGF5LmlzU3RhcnQsXHJcbiAgICAgICAgICAgICdyYW5nZS1lbmQnOiBkYXkuaXNFbmQsXHJcbiAgICAgICAgICAgICdpcy12aXNpYmxlJzogZGF5LmlzVmlzaWJsZSxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2tzIGlmIHNwZWNpZmllZCBkYXRlIGlzIGluIHJhbmdlIG9mIG1pbiBhbmQgbWF4IGRhdGVzXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaXNEYXRlU2VsZWN0YWJsZShkYXRlOiBEYXRlKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgbWluRGF0ZVNldCA9ICFpc051bGwodGhpcy5jdXJyZW50T3B0aW9ucy5taW5EYXRlKTtcclxuICAgICAgICBjb25zdCBtYXhEYXRlU2V0ID0gIWlzTnVsbCh0aGlzLmN1cnJlbnRPcHRpb25zLm1heERhdGUpO1xyXG4gICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IGRhdGUudmFsdWVPZigpO1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB0aGUgZGF0ZSByYW5nZSBpcyBzZXQgYW5kIGJldHdlZW4gbWluIGFuZCBtYXhcclxuICAgICAgICBjb25zdCBfaXNBYm92ZU1pbkRhdGUgPSBtaW5EYXRlU2V0ID8gdGltZXN0YW1wID49IHRoaXMuY3VycmVudE9wdGlvbnMubWluRGF0ZS52YWx1ZU9mKCkgOiB0cnVlO1xyXG4gICAgICAgIGNvbnN0IF9pc0JlbG93TWF4RGF0ZSA9IG1heERhdGVTZXQgPyB0aW1lc3RhbXAgPD0gdGhpcy5jdXJyZW50T3B0aW9ucy5tYXhEYXRlLnZhbHVlT2YoKSA6IHRydWU7XHJcblxyXG4gICAgICAgIHJldHVybiBfaXNBYm92ZU1pbkRhdGUgJiYgX2lzQmVsb3dNYXhEYXRlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNEYXRlU2VsZWN0ZWQoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJhbmdlICYmIHRoaXMucmFuZ2Uuc3RhcnQgPyBpc1NhbWVEYXRlKGRhdGUsIHRoaXMucmFuZ2Uuc3RhcnQpIHx8IGlzU2FtZURhdGUoZGF0ZSwgdGhpcy5yYW5nZS5lbmQpIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0luUmFuZ2UoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzRGF0ZVNlbGVjdGVkKGRhdGUpIHx8IHRoaXMucmFuZ2UgJiYgdGhpcy5yYW5nZS5zdGFydCA/IChpc0FmdGVyKGRhdGUsIHRoaXMucmFuZ2Uuc3RhcnQpICYmIGlzQmVmb3JlKGRhdGUsIHRoaXMucmFuZ2UuZW5kKSkgOiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZm9ybWF0RGlzcGxheSgpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghdGhpcy5yYW5nZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBmb3JtYXR0ZWRTdGFydERhdGUgPSBmb3JtYXQodGhpcy5yYW5nZS5zdGFydCwgdGhpcy5jdXJyZW50T3B0aW9ucy5kaXNwbGF5Rm9ybWF0LCB0aGlzLmN1cnJlbnRPcHRpb25zLmxvY2FsZSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRPcHRpb25zLnNlbGVjdFJhbmdlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZEVuZERhdGUgPSBmb3JtYXQoXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJhbmdlLmVuZCB8fCB0aGlzLnJhbmdlLnN0YXJ0LFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50T3B0aW9ucy5kaXNwbGF5Rm9ybWF0LFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50T3B0aW9ucy5sb2NhbGVcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBgJHtmb3JtYXR0ZWRTdGFydERhdGV9ICR7dGhpcy5jdXJyZW50T3B0aW9ucy5yYW5nZVNlcGFyYXRvcn0gJHtmb3JtYXR0ZWRFbmREYXRlfWA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZm9ybWF0dGVkU3RhcnREYXRlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNSYW5nZUJvdW5kYXJ5KGRhdGU6IERhdGUsIGJvdW5kYXJ5OiAnc3RhcnQnIHwgJ2VuZCcpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yYW5nZSA/ICF0aGlzLnJhbmdlW2JvdW5kYXJ5XSB8fCBpc1NhbWVEYXRlKGRhdGUsIHRoaXMucmFuZ2VbYm91bmRhcnldKSA6IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRWYWx1ZVRvRW1pdChyYW5nZTogRGF0ZVJhbmdlKTogRGF0ZVJhbmdlIHwgRGF0ZSB7XHJcblxyXG4gICAgICAgIGlmICghcmFuZ2UgfHwgIXJhbmdlLnN0YXJ0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRPcHRpb25zLnNlbGVjdFJhbmdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShyYW5nZS5zdGFydC5nZXRUaW1lKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHJhbmdlLmVuZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlRGF0ZVJhbmdlKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZURhdGVSYW5nZShyYW5nZS5zdGFydCwgcmFuZ2Uuc3RhcnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vICMjIyMjIyMjIyMjIyMjIyBEYXkgIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICBpbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy52aWV3aW5nRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzdGFydCA9IHN0YXJ0T2ZNb250aCh0aGlzLnZpZXdpbmdEYXRlKTtcclxuICAgICAgICBjb25zdCBlbmQgPSBlbmRPZk1vbnRoKHRoaXMudmlld2luZ0RhdGUpO1xyXG5cclxuICAgICAgICB0aGlzLmRheXMgPSBlYWNoRGF5T2ZJbnRlcnZhbCh7IHN0YXJ0LCBlbmQgfSkubWFwKChkYXRlKSA9PiB0aGlzLmZvcm1hdERheShkYXRlKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZpcnN0TW9udGhEYXkgPSBnZXREYXkoc3RhcnQpIC0gdGhpcy5jdXJyZW50T3B0aW9ucy5maXJzdENhbGVuZGFyRGF5O1xyXG4gICAgICAgIGNvbnN0IHByZXZEYXlzID0gZmlyc3RNb250aERheSA8IDAgPyA3IC0gdGhpcy5jdXJyZW50T3B0aW9ucy5maXJzdENhbGVuZGFyRGF5IDogZmlyc3RNb250aERheTtcclxuICAgICAgICBsZXQgbmV4dERheXMgPSAodGhpcy5jdXJyZW50T3B0aW9ucy5maXJzdENhbGVuZGFyRGF5ID09PSAxID8gNyA6IDYpIC0gZ2V0RGF5KGVuZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNob3dQcmV2TW9udGhEYXlzID0gdGhpcy5jdXJyZW50T3B0aW9ucy5pbmNsdWRlRGF5cyA9PT0gJ2FsbCcgfHwgdGhpcy5jdXJyZW50T3B0aW9ucy5pbmNsdWRlRGF5cyA9PT0gJ3ByZXZpb3VzLW1vbnRoJztcclxuICAgICAgICBjb25zdCBzaG93TmV4dE1vbnRoRGF5cyA9IHRoaXMuY3VycmVudE9wdGlvbnMuaW5jbHVkZURheXMgPT09ICdhbGwnIHx8IHRoaXMuY3VycmVudE9wdGlvbnMuaW5jbHVkZURheXMgPT09ICduZXh0LW1vbnRoJztcclxuXHJcbiAgICAgICAgaWYgKHNob3dOZXh0TW9udGhEYXlzICYmIHRoaXMuY3VycmVudE9wdGlvbnMuaW5jbHVkZU5leHRNb250aHNGaXJzdEZ1bGxXZWVrKSB7XHJcbiAgICAgICAgICAgIG5leHREYXlzICs9IDc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBwcmV2RGF5czsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF5cy51bnNoaWZ0KHRoaXMuZm9ybWF0RGF5KHN1YkRheXMoc3RhcnQsIGkpLCBzaG93UHJldk1vbnRoRGF5cykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmV3IEFycmF5KG5leHREYXlzKS5maWxsKHVuZGVmaW5lZClcclxuICAgICAgICAgICAgLmZvckVhY2goKF8sIGkpID0+IHRoaXMuZGF5cy5wdXNoKHRoaXMuZm9ybWF0RGF5KGFkZERheXMoZW5kLCBpICsgMSksIHNob3dOZXh0TW9udGhEYXlzKSkpO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5kaXNwbGF5VmFsdWUgPSB0aGlzLmZvcm1hdERpc3BsYXkoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucmFuZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5iYXJUaXRsZSA9IGZvcm1hdCh0aGlzLnZpZXdpbmdEYXRlLCB0aGlzLmN1cnJlbnRPcHRpb25zLmJhclRpdGxlRm9ybWF0LCB0aGlzLmN1cnJlbnRPcHRpb25zLmxvY2FsZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5iYXJUaXRsZSA9IHRoaXMuY3VycmVudE9wdGlvbnMudXNlRW1wdHlCYXJUaXRsZSA/XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRPcHRpb25zLmJhclRpdGxlSWZFbXB0eSA6XHJcbiAgICAgICAgICAgICAgICBmb3JtYXQodGhpcy52aWV3aW5nRGF0ZSwgdGhpcy5jdXJyZW50T3B0aW9ucy5iYXJUaXRsZUZvcm1hdCwgdGhpcy5jdXJyZW50T3B0aW9ucy5sb2NhbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXREYXRlKGk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLmRheXNbaV0uZGF0ZTtcclxuXHJcbiAgICAgICAgY29uc3QgX3JhbmdlOiBhbnkgPSB0aGlzLnJhbmdlIHx8IHt9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50T3B0aW9ucy5zZWxlY3RSYW5nZSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucmFuZ2UgfHwgKCF0aGlzLnJhbmdlLnN0YXJ0ICYmICF0aGlzLnJhbmdlLmVuZCkpIHtcclxuICAgICAgICAgICAgICAgIF9yYW5nZS5zdGFydCA9IGRhdGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yYW5nZS5zdGFydCAmJiAhdGhpcy5yYW5nZS5lbmQgJiYgaXNBZnRlcihkYXRlLCB0aGlzLnJhbmdlLnN0YXJ0KSkge1xyXG4gICAgICAgICAgICAgICAgX3JhbmdlLmVuZCA9IGRhdGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfcmFuZ2UuZW5kID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgX3JhbmdlLnN0YXJ0ID0gZGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIF9yYW5nZS5zdGFydCA9IF9yYW5nZS5lbmQgPSBkYXRlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yYW5nZSA9IF9yYW5nZTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKHRoaXMuZ2V0VmFsdWVUb0VtaXQodGhpcy5yYW5nZSkpO1xyXG5cclxuICAgICAgICAvLyBDbG9zZSBpZiBsYXN0IHZhbHVlIGlzIHNlbGVjdGVkXHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudE9wdGlvbnMuY2xvc2VPblNlbGVjdGlvbiAmJiB0aGlzLnJhbmdlLmVuZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluaXREYXlOYW1lcygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRheU5hbWVzID0gW107XHJcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmN1cnJlbnRPcHRpb25zLmZpcnN0Q2FsZW5kYXJEYXk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSA2ICsgc3RhcnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gc2V0RGF5KG5ldyBEYXRlKCksIGkpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kYXlOYW1lcy5wdXNoKGZvcm1hdChkYXRlLCB0aGlzLmN1cnJlbnRPcHRpb25zLmRheU5hbWVzRm9ybWF0LCB0aGlzLmN1cnJlbnRPcHRpb25zLmxvY2FsZSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAjIyMjIyMjIyMjIyMjIyMgTW9udGggIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgc2V0TW9udGgoaTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy52aWV3aW5nRGF0ZSA9IHNldE1vbnRoKHRoaXMudmlld2luZ0RhdGUsIHRoaXMubW9udGhzW2ldLm1vbnRoKTtcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgICAgICB0aGlzLmluaXRNb250aHMoKTtcclxuICAgICAgICB0aGlzLnZpZXcgPSAnZGF5cyc7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdE1vbnRocygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm1vbnRocyA9IEFycmF5LmZyb20obmV3IEFycmF5KDEyKSwgKHgsIGkpID0+IHNldE1vbnRoKG5ldyBEYXRlKCksIGkpKVxyXG4gICAgICAgICAgICAubWFwKChkYXRlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyBtb250aDogZGF0ZS5nZXRNb250aCgpLCBuYW1lOiBmb3JtYXQoZGF0ZSwgJ01NTScpLCBpc1NlbGVjdGVkOiBkYXRlLmdldE1vbnRoKCkgPT09IGdldE1vbnRoKHRoaXMudmlld2luZ0RhdGUpIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5leHRNb250aCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnZpZXdpbmdEYXRlID0gYWRkTW9udGhzKHRoaXMudmlld2luZ0RhdGUsIDEpO1xyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByZXZNb250aCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnZpZXdpbmdEYXRlID0gc3ViTW9udGhzKHRoaXMudmlld2luZ0RhdGUsIDEpO1xyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vICMjIyMjIyMjIyMjIyMjIyBZZWFyICMjIyMjIyMjIyMjIyMjIyNcclxuXHJcblxyXG4gICAgaW5pdFllYXJzKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHJhbmdlID0gdGhpcy5jdXJyZW50T3B0aW9ucy5tYXhZZWFyIC0gdGhpcy5jdXJyZW50T3B0aW9ucy5taW5ZZWFyO1xyXG5cclxuICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZSAqL1xyXG4gICAgICAgIC8vIElnbm9yZSB0aGUgcnVsZSBkdWUgdG8gdGhlIHVuaXFlbmVzcyBvZiB0aGUgYXJyb3cgY2hhaW4uXHJcbiAgICAgICAgdGhpcy55ZWFycyA9IEFycmF5LmZyb20obmV3IEFycmF5KHJhbmdlKSwgKHgsIGkpID0+IHsgcmV0dXJuIHsgaW5kZXg6IGksIHllYXI6IGkgKyB0aGlzLmN1cnJlbnRPcHRpb25zLm1pblllYXIgfTsgfSkubWFwKCh7IGluZGV4LCB5ZWFyIH0pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IGluZGV4LCB5ZWFyOiB5ZWFyLCBpc1RoaXNZZWFyOiB5ZWFyID09PSBnZXRZZWFyKHRoaXMudmlld2luZ0RhdGUpIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLyogdHNsaW50OmVuYWJsZSAqL1xyXG4gICAgfVxyXG5cclxuICAgIHNjcm9sbFllYXJzKCk6IHZvaWQge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBfaGVpZ2h0T2ZZZWFyRWxlbWVudCA9IDQwO1xyXG4gICAgICAgICAgICBjb25zdCBfeWVhckluZGV4ID0gdGhpcy55ZWFycy5maWx0ZXIoaXRlbSA9PiBpdGVtLmlzVGhpc1llYXIpWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBfc2Nyb2xsUG9zaXRpb24gPSAoKF95ZWFySW5kZXguaW5kZXggLyAzKSAqIF9oZWlnaHRPZlllYXJFbGVtZW50KSAtIDMwO1xyXG4gICAgICAgICAgICB0aGlzLmNhbGVuZGFyWWVhcnNDb250YWluZXIubmF0aXZlRWxlbWVudC5zY3JvbGwoMCwgX3Njcm9sbFBvc2l0aW9uKTtcclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFllYXIoaTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy52aWV3aW5nRGF0ZSA9IHNldFllYXIodGhpcy52aWV3aW5nRGF0ZSwgdGhpcy55ZWFyc1tpXS55ZWFyKTtcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgICAgICB0aGlzLmluaXRZZWFycygpO1xyXG4gICAgICAgIHRoaXMudmlldyA9ICdtb250aHMnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vICMjIyMjIyMjIyMjIyMjIyBDb250YWluZXIgIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIHRvZ2dsZVZpZXcoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy52aWV3ID0gdGhpcy52aWV3ID09PSAnZGF5cycgPyAneWVhcnMnIDogJ2RheXMnO1xyXG4gICAgICAgIHRoaXMuc2Nyb2xsWWVhcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5pc09wZW5lZCA9ICF0aGlzLmlzT3BlbmVkO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNPcGVuZWQgJiYgdGhpcy52aWV3ID09PSAneWVhcnMnKSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVmlldygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNPcGVuZWQgJiYgdGhpcy52aWV3ID09PSAnZGF5cycpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3aW5nRGF0ZSA9IHRoaXMucmFuZ2UgJiYgdGhpcy5yYW5nZS5zdGFydCA/IHRoaXMucmFuZ2Uuc3RhcnQgOiB0aGlzLnZpZXdpbmdEYXRlIHx8IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJhbmdlID0ge1xyXG4gICAgICAgICAgICBzdGFydDogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgZW5kOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gIyMjIyMjIyMjIyMjIyMjIE1pc2MgIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmNsaWNrJywgWyckZXZlbnQnXSkgb25CbHVyKGU6IE1vdXNlRXZlbnQpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzT3BlbmVkIHx8ICF0aGlzLmN1cnJlbnRPcHRpb25zLmNsb3NlT25DbGlja091dHNpZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCgoZS50YXJnZXQgYXMgYW55KS5wYXJlbnRFbGVtZW50ICYmIChlLnRhcmdldCBhcyBhbnkpLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkYXktdW5pdCcpKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jYWxlbmRhckNvbnRhaW5lckVsZW1lbnQubmF0aXZlRWxlbWVudCAhPT0gZS50YXJnZXQgJiZcclxuICAgICAgICAgICAgIXRoaXMuY2FsZW5kYXJDb250YWluZXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQgYXMgYW55KSAmJlxyXG4gICAgICAgICAgICAhKGUudGFyZ2V0IGFzIGFueSkuY2xhc3NMaXN0LmNvbnRhaW5zKCd5ZWFyLXVuaXQnKSAmJlxyXG4gICAgICAgICAgICAhKGUudGFyZ2V0IGFzIGFueSkuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb250aC11bml0JylcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmlzT3BlbmVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnZpZXcgPT09ICd5ZWFycycpIHtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVWaWV3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==